<!DOCTYPE html>
<html lang="zh">
<head>

        <title>9Hao</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/theme/pygment.css" />

        <script src="/theme/js/libs/modernizr-2.6.2.min.js"></script>






</head>

<body id="index" class="home">

<!-- Fork me on github -->

    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                 <!-- <h1><a href="/">9Hao <strong>人若无名,正是安心练剑之时</strong></a></h1>  -->
                 <h1><a href="/"><strong>9Hao</strong><p style="font-size:50%">人若无名,正是安心练剑之时</p></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">Home</a></li>
					<!--<li><a href="/category/about-me.html">About me</a></li>-->
					<li><a href="/category/about-me.html">About me</a></li>
					<!--<li><a href="/category/android.html">Android</a></li>-->
					<li><a href="/category/android.html">Android</a></li>
					<!--<li><a href="/category/internet.html">Internet</a></li>-->
					<li><a href="/category/internet.html">Internet</a></li>
				<li><a href="/functions/archives.html">Archives</a></li>
				<!--<li><a href="/functions/random.html">Random Article</a></li>
				<!--
				
				-->
              </ul>
            </div>

<section id="content">

   <div class="row">

        <div class="eleven columns">

		
		         <ol id="post-list">
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="/pages/2014/07/qian-tan-androidni-xiang-fen-xi-na-xie-lan-lu-hu" rel="bookmark" title="Permalink to 浅谈android逆向分析那些拦路虎">浅谈android逆向分析那些拦路虎</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-07-27T00:00:00"> 日 27 七月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									日 27 七月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <blockquote>
<p><strong>0x0 前言</strong>   </p>
</blockquote>
<p>&emsp;&emsp;接触android逆向分析一年有余,碰到好些Android的逆向的拦路虎，也见证了android软件防护在一年中的发展历程，记录下遇到的一些问题。   </p>
<blockquote>
<p><strong>0x1 混淆</strong>    </p>
</blockquote>
<p>&emsp;&emsp;刚开始的android软件没经过代码混淆，这中些apk的smali看起来很明了，把dex转换成jar，用jd-gui查看，跟看源码差不多了（ps：jd-gui处理多重异常会出问题），后面混淆出现，大概有三种：   </p>
<div class="highlight"><pre><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="err">普通混淆，类名、变量名、函数名变成</span> <span class="n">a</span><span class="err">、</span><span class="n">b</span><span class="err">、</span><span class="n">c</span><span class="err">这种，最常见</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="err">自定义混淆，类名、变量名、函数名变成</span> <span class="mi">0</span><span class="n">oOO0o</span><span class="err">、</span><span class="n">li1Ll</span><span class="err">这种，你看</span><span class="n">smali</span><span class="err">就眼花撩乱</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="n">unicode</span><span class="err">混淆</span> <span class="o">?</span>  <span class="err">这种混淆没还研究到，类名、变量名、函数名变成</span> <span class="err">中文乱码，样本是</span> <span class="err">豌豆荚</span>
</pre></div>


<p>~~<strong>反混淆 ...</strong></p> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="/pages/2014/07/qian-tan-androidni-xiang-fen-xi-na-xie-lan-lu-hu" rel="bookmark" title="Permalink to 浅谈android逆向分析那些拦路虎">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="/tag/android.html">Android</a>
											<a class="danger label" href="/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="/pages/2014/07/androidni-xiang-fen-xi-zhi-smalidong-tai-diao-shi" rel="bookmark" title="Permalink to android逆向分析之smali动态调试">android逆向分析之smali动态调试</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-07-21T00:00:00"> 一 21 七月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									一 21 七月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p>(不知攻，焉知防！) </p>
<p>smali动态调试网上已经有很多文章了，刚开始开始是Apktool1.4.2支持，后面后面几个版本就阉割，貌似不稳定，到了 Apktool 2.0之后的版本又重新放出。给几个教程连接：</p>
<p><a href="http://code.google.com/p/android-apktool/wiki/SmaliDebugging">官网说明SmaliDebugging</a></p>
<blockquote>
<p><strong>Netbean</strong> </p>
</blockquote>
<p>[1]<a href="http://www.rover12421.com/2012/11/05/using-netbean-and-apktool-debugging-smali-code.html">使用Netbean和Apktool调试smali</a><br />
[2]<a href="http://www.colordancer.net/blog/2013/09/16/apktool-2-0-netbeans-7-3-%E8%B0%83%E8%AF%95apk/">apktool 2.0+netbeans 7.3调试apk</a><br />
[3]<a href="http://0nly3nd.sinaapp.com/?p=576">Netbeans 6.8 + apktool_2.0.0b9 动态调试smali文件</a>  </p>
<blockquote>
<p><strong>eclipse</strong> </p>
</blockquote>
<p><a href="http://blog.csdn.net/xbalien29/article/details/27564365">apktool + eclipse 动态调试APK</a></p>
<p>个人用eclipse习惯了，比较倾向于eclipse。</p>
<p>动态调试还有jdb，andbug，JSwat Debugger，ida等等，谈谈每种调试的优劣.  </p>
<blockquote>
<p>jdb</p>
</blockquote>
<div class="highlight"><pre><span class="err">刚开始接触动态调试的时候是</span><span class="n">jdb</span><span class="err">，支持调试的基本功能，优点：可以在配置文件里面预下断点 ...</span></pre></div> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="/pages/2014/07/androidni-xiang-fen-xi-zhi-smalidong-tai-diao-shi" rel="bookmark" title="Permalink to android逆向分析之smali动态调试">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="/tag/android.html">Android</a>
											<a class="danger label" href="/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="/pages/2014/07/androidni-xiang-fen-xi-zhi-logpian" rel="bookmark" title="Permalink to android逆向分析之log篇">android逆向分析之log篇</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-07-20T00:00:00"> 日 20 七月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									日 20 七月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p>(不知攻，焉知防！)   </p>
<blockquote>
<p><strong>0x0 前言</strong>  </p>
</blockquote>
<p>&emsp;&emsp;在以前逆向分析的分析，动态调试不成熟的时候，需要在反汇编程序smali插入汇编代码来追踪apk运行信息（也有人叫这种为smali注入）。想一下程序调试过程，断点，单步跟踪，查看寄存器/变量信息，看函数调用堆栈等等，通过调试过程来反馈的信息来分析apk。那么我们怎么用smali注入来达到“动态调试”目的?</p>
<blockquote>
<p><strong>0x1 "断点"，"单步跟踪"，查看寄存器/变量信息</strong>  </p>
</blockquote>
<p>&emsp;&emsp; 我们在关键的地方插入了log打印，如果程序执行到这个我们插入log的地方，输出我们打印的信息，这样是不是有点像"断点"触发","跟踪"，还输出了寄存器/变量信息?  虽然不能单步调试，至少能拿到一些信息。刚开始接触日志打印的时候，网上给的经验都是用系统log类调试。你用这个类会发现一个问题，他需要两个寄存器的值，invoke-static {vx, vy}, Landroid/util/Log;-&gt;v(Ljava/lang/String;Ljava/lang ...</p> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="/pages/2014/07/androidni-xiang-fen-xi-zhi-logpian" rel="bookmark" title="Permalink to android逆向分析之log篇">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="/tag/android.html">Android</a>
											<a class="danger label" href="/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="/pages/2014/07/androidni-xiang-fen-xi-zhi-chu-tan-di-ying" rel="bookmark" title="Permalink to android逆向分析之初探敌营">android逆向分析之初探敌营</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-07-15T00:00:00"> 二 15 七月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									二 15 七月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p>(不知攻，焉知防！)</p>
<div class="highlight"><pre><span class="err">前言</span>
</pre></div>


<p>&emsp;&emsp;参考非虫大大的书和写一些个人经验。在逆向一个Android程序，如果盲目的分析，有可能遇到阅读成千上万的反汇编代码才能找到程序的关键点，这无疑是浪费时间的表现。那么我们要对一个陌生的apk后怎么入手？</p>
<div class="highlight"><pre><span class="mh">0x01</span> <span class="err">初探</span>
</pre></div>


<p>&emsp;&emsp;1 拿到一个apk，不要急于直接看汇编代码，先浏览一下apk的字符串信息，再大略浏览一下类和函数,大体在脑子里留个印象。</p>
<p>&emsp;&emsp;2 application类 apk一般初始化配置的地方，壳初始化,如果有要注意下。</p>
<p>&emsp;&emsp;3 主activity,程序的一般入口。</p>
<p>&emsp;&emsp;4 如果是搞病毒木马分析，要注意 server和 广播。</p>
<div class="highlight"><pre><span class="mh">0x02</span> <span class="err">定位</span>
</pre></div>


<p>&emsp;&emsp;1 信息反馈法</p>
<div class="highlight"><pre>    <span class="n">a</span> <span class="err">上面我们提到先看字符串信息，根据你需求，你应该对一些字符串很敏感。比如你是想找内支付的，那有可能出现“支付成功”</span><span class="p">,</span><span class="err">“支付失败”；你要找登录验证的，可能有</span><span class="s">&quot;登录成功&quot;</span><span class="err">、“登录失败”；病毒木马可能有“指令”“</span><span class="n">xxx</span><span class="err">成功等 ...</span></pre></div> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="/pages/2014/07/androidni-xiang-fen-xi-zhi-chu-tan-di-ying" rel="bookmark" title="Permalink to android逆向分析之初探敌营">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="/tag/android.html">Android</a>
											<a class="danger label" href="/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="/pages/2014/06/about-me" rel="bookmark" title="Permalink to About me">About me</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-06-20T00:00:00"> 五 20 六月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									五 20 六月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p><img alt="头像" src="http://www.opendrive.com/files/Ml82MjQ3MzE4OV9nNlRlTA/maoxiao.jpg" /><br />
<em>伪码农一枚</em><br />
<em>伪安全工作者一枚</em><br />
<em>业余Android安全研究人员</em><br />
<em>擅长apk逆向分析，逆向工具编写</em>   </p>
<p><em>邮箱:feiqishizu2014#foxmail.com(把#换成@)</em>    </p> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="/pages/2014/06/about-me" rel="bookmark" title="Permalink to About me">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="/tag/guan-yu-wo.html">关于我</a>
								</div>



				        </article></li>
				</ol><!-- /#posts-list -->

        </div><!-- /.eleven.columns -->
        
<div class="three columns">

<div class="sidebarbg">
	<h4>Pages</h4>
	<ul>
	</ul>
</div>

<div class="sidebarbg">
<h4>Categories</h4>
	<ul>
			<li><a href="/category/about-me.html">About me</a></li>
			<li><a href="/category/android.html">Android</a></li>
			<li><a href="/category/internet.html">Internet</a></li>
	</ul>
</div>

<div class="sidebarbg">
	<h4>Tags</h4>
		<ul>
			<li class="tag-1"><a href="/tag/android.html">Android</a></li>
			<li class="tag-3"><a href="/tag/hook.html">Hook</a></li>
			<li class="tag-1"><a href="/tag/ni-xiang-fen-xi.html">逆向分析</a></li>
			<li class="tag-4"><a href="/tag/guan-yu-wo.html">关于我</a></li>
			<li class="tag-4"><a href="/tag/za-wen.html">杂文</a></li>
		</ul>
</div>



<nav class="widget sidebarbg">
  <h4>Links</h4>
  <ul>
	<li><a target="_blank" href="http://getpelican.com/">Pelican</a></li>
	<li><a target="_blank" href="http://python.org/">Python.org</a></li>
	<li><a target="_blank" href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html">Dalvik opcodes</a></li>
	<li><a target="_blank" href="http://0nly3nd.sinaapp.com">0nly3nd(后生可畏)</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->

<p class="paginator">
            <a href="/index.html"><i class="icon-arrow-left"></i></a>
    Page 2 / 3
        <a href="/index3.html"><i class="icon-arrow-right"></i></a>
</p>
</section><!-- /#content -->

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">
					本博客使用Pelican+GitHub Pages搭建，详细请参考<a href="http://www.xycoding.com/articles/2013/11/21/blog-create/" class="active" target="_blank">教程</a>。
				   </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = '9haoblog';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

      <script src="/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/theme/js/libs/gumby.min.js"></script>
  <script src="/theme/js/plugins.js"></script>
	<script>
	(function() {
		var $backToTopTxt = "返回顶部", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
			.text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
				$("html, body").animate({ scrollTop: 0 }, 120);
		}), $backToTopFun = function() {
			var st = $(document).scrollTop(), winh = $(window).height();
			(st > 0)? $backToTopEle.show(): $backToTopEle.hide();
			//IE6下的定位
			if (!window.XMLHttpRequest) {
				$backToTopEle.css("top", st + winh - 166);
			}
		};
		$(window).bind("scroll", $backToTopFun);
		$(function() { $backToTopFun(); });
	})();
	</script>
</body>
</html>