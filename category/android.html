<!DOCTYPE html>
<html lang="zh">
<head>

        <title>9Hao</title>
        <meta charset="utf-8" />
        <link href="http://9hao.info/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="9Hao Full RSS Feed" />
        <link href="http://9hao.info/feeds/android.rss.xml" type="application/atom+xml" rel="alternate" title="9Hao Categories Atom Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="http://9hao.info/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="http://9hao.info/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="http://9hao.info/theme/pygment.css" />

        <script src="http://9hao.info/theme/js/libs/modernizr-2.6.2.min.js"></script>






</head>

<body id="index" class="home">

<!-- Fork me on github -->

    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                 <!-- <h1><a href="/">9Hao <strong>人若无名,正是安心练剑之时</strong></a></h1>  -->
                 <h1><a href="/"><strong>9Hao</strong><p style="font-size:50%">人若无名,正是安心练剑之时</p></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">Home</a></li>
					<!--<li><a href="http://9hao.info/category/about-me.html">About me</a></li>-->
					<li><a href="http://9hao.info/category/about-me.html">About me</a></li>
					<!--<li class="active"><a href="http://9hao.info/category/android.html">Android</a></li>-->
					<li><a href="http://9hao.info/category/android.html">Android</a></li>
					<!--<li><a href="http://9hao.info/category/internet.html">Internet</a></li>-->
					<li><a href="http://9hao.info/category/internet.html">Internet</a></li>
				<li><a href="/functions/archives.html">Archives</a></li>
				<!--<li><a href="/functions/random.html">Random Article</a></li>
				<!--
				
				-->
              </ul>
            </div>

<section id="content">

   <div class="row">

        <div class="eleven columns">
<h2>Articles in the Android category</h2>
		
		         <ol id="post-list">
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="http://9hao.info/pages/2014/10/qing-liang-dalvik-java-hookkuang-jia" rel="bookmark" title="Permalink to 轻量dalvik java hook框架">轻量dalvik java hook框架</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-10-20T00:00:00"> 一 20 十月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="http://9hao.info/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									一 20 十月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="http://9hao.info/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p>&emsp;&emsp;很早之前学习xposed源码写了个java hook框架，不过配置比较麻烦，需要源码下编译，后面看了boyliang的《<a href="http://blog.csdn.net/l173864930/article/details/39667355">Hook Java的的一个改进版本</a>》,编译配置比较容易，花时间自己重写一个。(git:https://github.com/9hao/SwatHookV2)</p>
<p>&emsp;&emsp;两个对比了下，个人感觉xposed的 xposedAddLocalReference 函数用得很好，把Object*转为jobject,而boyliang的dvmGetMethodParamTypes函数用得很好，学习了ArrayObject的构造放方法，利用Object* 来调用一些函数。  </p>
<p>有人问我两个问题：<br />
[1] hook imsi对某些软件没效果。<br />
&emsp;&emsp; 对此这类读取可以hook更底层的函数，服务的代理类，比如获取IMSI的函数getSubscriberId，可以对它的代理类com.android.internal.telephony.IPhoneSubInfo$Stub$Proxy的getSubscriberId进行hook，同理别的服务也类似。（反过来，你也可以反射代理类来过别人简单的hook）  </p>
<p>[2]动态加载hook不起效果<br />
&emsp;&emsp;这个应该是hook的时机不对，xposed的一般hook是从加载apk后就进行FindClass查找目标函数进行hook，后面动态加载的class还没加载进来，FindClass目标函数就失败了，hook就不上了，针对这个情况 ...</p> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="http://9hao.info/pages/2014/10/qing-liang-dalvik-java-hookkuang-jia" rel="bookmark" title="Permalink to 轻量dalvik java hook框架">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="http://9hao.info/tag/android.html">Android</a>
											<a class="danger label" href="http://9hao.info/tag/java.html">java</a>
											<a class="danger label" href="http://9hao.info/tag/hook.html">Hook</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="http://9hao.info/pages/2014/09/apkprsi-wei-dao-tu" rel="bookmark" title="Permalink to apkpr思维导图">apkpr思维导图</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-09-16T00:00:00"> 二 16 九月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="http://9hao.info/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									二 16 九月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="http://9hao.info/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p>乱画个，mark
<img alt="apkpro2" src="http://r.photo.store.qq.com/psb?/V11zdJUK1IY4eb/qJ6tiHrbVjWmR27L4Bc2bkJ1333JLUoapq4QccARrEc!/r/dPXKqlfYCAAA" /></p> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="http://9hao.info/pages/2014/09/apkprsi-wei-dao-tu" rel="bookmark" title="Permalink to apkpr思维导图">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="http://9hao.info/tag/android.html">Android</a>
											<a class="danger label" href="http://9hao.info/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="http://9hao.info/pages/2014/08/dexwen-jian-jie-gou-si-wei-dao-tu" rel="bookmark" title="Permalink to dex文件结构思维导图">dex文件结构思维导图</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-08-27T00:00:00"> 三 27 八月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="http://9hao.info/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									三 27 八月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="http://9hao.info/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <p><img alt="dex" src="http://r.photo.store.qq.com/psb?/V11zdJUK1IY4eb/PSecMGllcbfSieniYUll.fwk9tjBh9I.HOnly82jYkI!/r/dAqdEFfNBgAA" /></p> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="http://9hao.info/pages/2014/08/dexwen-jian-jie-gou-si-wei-dao-tu" rel="bookmark" title="Permalink to dex文件结构思维导图">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="http://9hao.info/tag/android.html">Android</a>
											<a class="danger label" href="http://9hao.info/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="http://9hao.info/pages/2014/08/qian-tan-androidwan-zheng-xing-jian-ce" rel="bookmark" title="Permalink to 浅谈android完整性检测">浅谈android完整性检测</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-08-24T00:00:00"> 日 24 八月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="http://9hao.info/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									日 24 八月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="http://9hao.info/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <blockquote>
<p>常见android完整性检测</p>
</blockquote>
<div class="highlight"><pre><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="err">检测签名</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="err">校验</span><span class="n">classes</span><span class="p">.</span><span class="n">dex</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="err">检验整个</span><span class="n">apk</span><span class="p">(</span><span class="err">这种比较少见</span><span class="p">)</span>
</pre></div>


<blockquote>
<p>验证哪方面的检测</p>
</blockquote>
<p>&emsp;&emsp;先直接对apk进行签名，然后安装运行，如果运行出错那么可以推测有签名检测；如果签名没问题，那反编译再回编译安装运行出问题，那么说明有校验classes.dex校验。</p>
<blockquote>
<p>找到校验的地方</p>
</blockquote>
<div class="highlight"><pre><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="err">针对签名</span> <span class="o">:</span> <span class="err">可以搜索</span><span class="n">getPackageInfo</span> <span class="err">、</span><span class="n">PackageManager</span><span class="err">、</span> <span class="n">Signature</span><span class="err">、</span><span class="n">signatures</span><span class="err">、签名信息</span><span class="n">RSA</span><span class="err">文件。</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="err">针对</span><span class="n">classes</span><span class="p">.</span><span class="n">dex</span><span class="p">,</span> <span class="err">搜索</span><span class="n">classes</span><span class="p">.</span><span class="n">dex</span><span class="p">,</span><span class="err">解压缩</span><span class="n">ZipEntry</span><span class="err">，资源文件读取也可以注意下</span><span class="p">.(</span><span class="err">还有一些，暂时不记得了</span><span class="p">)</span><span class="err">。</span>
<span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="err">算法</span> <span class="n">md5</span><span class="p">,</span><span class="n">hash</span><span class="err">。</span>
<span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="err">退出函数、错误提示等。</span>
<span class="err">搜索这些特征函数和字符串 ...</span></pre></div> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="http://9hao.info/pages/2014/08/qian-tan-androidwan-zheng-xing-jian-ce" rel="bookmark" title="Permalink to 浅谈android完整性检测">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="http://9hao.info/tag/android.html">Android</a>
											<a class="danger label" href="http://9hao.info/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				        <li><article class="hentry">
				                <header> <h2 class="entry-title"><a href="http://9hao.info/pages/2014/08/android-soke-ru-kou-qian-xi" rel="bookmark" title="Permalink to android so壳入口浅析">android so壳入口浅析</a></h2> </header>
				                <footer class="post-info">
				                    <!--<abbr class="published" title="2014-08-13T00:00:00"> 三 13 八月 2014 </abbr>
<address class="vcard author">By <a class="url fn" href="http://9hao.info/author/123.html">#123</a></address>-->
								 <address class="vcard author" style="font-style:italic;">
									三 13 八月 2014
										&nbsp;&nbsp;Write By <a class="url fn" href="http://9hao.info/author/123.html">#123</a>
								  </address>
									
				                </footer><!-- /.post-info -->
				                <div class="entry-content"> <blockquote>
<p>前言  </p>
</blockquote>
<p>&emsp;&emsp;开年来开始接触一些加固样本，基本都对了so进行了处理，拖入ida一看，要么没有 <strong>JNI_OnLoad</strong>   ,要么 <strong>JNI_OnLoad</strong>   汇编代码羞涩难懂，让人无法下手。 <strong>JNI_OnLoad</strong>   是真正入口么？  </p>
<p>先看看几个文档  </p>
<p><strong>1  摘自属性服务一节（《深入理解Android卷1》）</strong>  </p>
<div class="highlight"><pre>     <span class="err">利用</span><span class="nx">gcc</span><span class="err">的</span><span class="nx">constructor</span><span class="err">属性，这个属性指明了一个</span><span class="nx">__libc_prenit</span><span class="err">函数</span><span class="p">(</span><span class="err">这个函数内部就将完成共享内存到本地进程的映射工作</span><span class="p">)</span><span class="err">。用法：当</span><span class="nx">bionic</span> <span class="nx">libc</span><span class="err">库被加载时，将自动调用</span><span class="nx">__libc_prenit</span><span class="err">函数。这样在</span><span class="nx">bionic</span> <span class="nx">libc</span><span class="err">动态库被装载时，系统属性缓冲区地址就被确定了，后续的</span><span class="nx">API</span><span class="err">调用就能找对位置了。</span>

<span class="cm">/* We flag the __libc_preinit function as a constructor to ...</span></pre></div> </div><!-- /.entry-content -->

								<div class="medium primary btn"><a href="http://9hao.info/pages/2014/08/android-soke-ru-kou-qian-xi" rel="bookmark" title="Permalink to android so壳入口浅析">Read more <i class="icon-arrow-right"></i></a></div>



								<div class="row tag-row">
										<span>Tagged as : </span>
											<a class="danger label" href="http://9hao.info/tag/android.html">Android</a>
											<a class="danger label" href="http://9hao.info/tag/ni-xiang-fen-xi.html">逆向分析</a>
								</div>



				        </article></li>
				</ol><!-- /#posts-list -->

        </div><!-- /.eleven.columns -->
        
<div class="three columns">

<div class="sidebarbg">
	<h4>Pages</h4>
	<ul>
	</ul>
</div>

<div class="sidebarbg">
<h4>Categories</h4>
	<ul>
			<li><a href="http://9hao.info/category/about-me.html">About me</a></li>
			<li><a href="http://9hao.info/category/android.html">Android</a></li>
			<li><a href="http://9hao.info/category/internet.html">Internet</a></li>
	</ul>
</div>

<div class="sidebarbg">
	<h4>Tags</h4>
		<ul>
			<li class="tag-1"><a href="http://9hao.info/tag/ni-xiang-fen-xi.html">逆向分析</a></li>
			<li class="tag-4"><a href="http://9hao.info/tag/guan-yu-wo.html">关于我</a></li>
			<li class="tag-4"><a href="http://9hao.info/tag/java.html">java</a></li>
			<li class="tag-1"><a href="http://9hao.info/tag/android.html">Android</a></li>
			<li class="tag-4"><a href="http://9hao.info/tag/za-wen.html">杂文</a></li>
			<li class="tag-2"><a href="http://9hao.info/tag/hook.html">Hook</a></li>
		</ul>
</div>



<nav class="widget sidebarbg">
  <h4>Links</h4>
  <ul>
	<li><a target="_blank" href="http://getpelican.com/">Pelican</a></li>
	<li><a target="_blank" href="http://python.org/">Python.org</a></li>
	<li><a target="_blank" href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html">Dalvik opcodes</a></li>
	<li><a target="_blank" href="http://0nly3nd.sinaapp.com">0nly3nd</a></li>
	<li><a target="_blank" href="http://blog.csdn.net/guiguzi1110">听鬼哥说故事(游戏破解控)</a></li>
	<li><a target="_blank" href="http://blog.csdn.net/l173864930">简行之旅</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->

<p class="paginator">
    Page 1 / 3
        <a href="http://9hao.info/category/android2.html"><i class="icon-arrow-right"></i></a>
</p>
</section><!-- /#content -->

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">
					本博客使用Pelican+GitHub Pages搭建，详细请参考<a href="http://www.xycoding.com/articles/2013/11/21/blog-create/" class="active" target="_blank">教程</a>。
				   </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = '9haoblog';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

      <script src="http://9hao.info/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="http://9hao.info/theme/js/libs/gumby.min.js"></script>
  <script src="http://9hao.info/theme/js/plugins.js"></script>
	<script>
	(function() {
		var $backToTopTxt = "返回顶部", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
			.text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
				$("html, body").animate({ scrollTop: 0 }, 120);
		}), $backToTopFun = function() {
			var st = $(document).scrollTop(), winh = $(window).height();
			(st > 0)? $backToTopEle.show(): $backToTopEle.hide();
			//IE6下的定位
			if (!window.XMLHttpRequest) {
				$backToTopEle.css("top", st + winh - 166);
			}
		};
		$(window).bind("scroll", $backToTopFun);
		$(function() { $backToTopFun(); });
	})();
	</script>
</body>
</html>