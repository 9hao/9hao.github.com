﻿<!DOCTYPE html>
<html lang="zh">
<head>

        <title>dalvik java hook工程</title>
        <meta charset="utf-8" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/theme/pygment.css" />

        <script src="/theme/js/libs/modernizr-2.6.2.min.js"></script>






</head>

<body id="index" class="home">

<!-- Fork me on github -->

    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                 <!-- <h1><a href="/">9Hao <strong>人若无名,正是安心练剑之时</strong></a></h1>  -->
                 <h1><a href="/"><strong>9Hao</strong><p style="font-size:50%">人若无名,正是安心练剑之时</p></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">Home</a></li>
					<!--<li><a href="/category/about-me.html">About me</a></li>-->
					<li><a href="/category/about-me.html">About me</a></li>
					<!--<li class="active"><a href="/category/android.html">Android</a></li>-->
					<li><a href="/category/android.html">Android</a></li>
					<!--<li><a href="/category/internet.html">Internet</a></li>-->
					<li><a href="/category/internet.html">Internet</a></li>
					<!--<li><a href="/category/za-sui-sui.html">杂碎碎</a></li>-->
					<li><a href="/category/za-sui-sui.html">杂碎碎</a></li>
				<li><a href="/functions/archives.html">Archives</a></li>
				<!--<li><a href="/functions/random.html">Random Article</a></li>
				<!--
				
				-->
              </ul>
            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/pages/2014/10/dalvik-java-hookgong-cheng" rel="bookmark"
                   title="Permalink to dalvik java hook工程">dalvik java hook工程</a></h2>
           
            </header>
            <footer class="post-info">
              <!--
			  <abbr class="published" title="2014-10-20T00:00:00">
                一 20 十月 2014
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="/author/123.html">#123</a>
              </address>
			  -->
			  <address class="vcard author" style="font-style:italic;margin-bottom:-10px;">
				一 20 十月 2014
					&nbsp;&nbsp;Write By <a class="url fn" href="/author/123.html">#123</a>
	
			  </address>
			  <hr />			  
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <p>&emsp;&emsp;很早之前学习xposed源码写了个java hook框架，不过配置比较麻烦，需要源码下编译，后面看了boyliang的《<a href="http://blog.csdn.net/l173864930/article/details/39667355">Hook Java的的一个改进版本</a>》,编译配置比较容易，花时间自己重写一个。     (git:https://github.com/9hao/SwatHookV2)</p>
<p>&emsp;&emsp;两个对比了下，个人感觉xposed的 xposedAddLocalReference 函数用得很好，把Object*转为jobject,而boyliang的dvmGetMethodParamTypes函数用得很好，学习了ArrayObject的构造放方法，利用Object* 来调用一些函数。  </p>
<p>有人问我两个问题：<br />
[1] hook imsi对某些软件没效果。<br />
&emsp;&emsp; 对此这类读取可以hook更底层的函数，服务的代理类，比如获取IMSI的函数getSubscriberId，可以对它的代理类com.android.internal.telephony.IPhoneSubInfo\$Stub$Proxy的getSubscriberId进行hook，同理别的服务也类似。（反过来，你也可以反射代理类来过别人简单的hook）  </p>
<p>[2]动态加载hook不起效果<br />
&emsp;&emsp;这个应该是hook的时机不对，xposed的一般hook是从加载apk后就进行FindClass查找目标函数进行hook，后面动态加载的class还没加载进来，FindClass目标函数就失败了，hook就不上了，针对这个情况，应检测动态加载的模块是否加载进来再hook，或者hook动态加载函数，检测加载完成后进行hook。  </p>
            </div><!-- /.entry-content -->
			            <aside>
            <hr/>
            <!-- all by Qxia -->

            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="/pages/2014/09/o" title="Previous: o">o</a></li>
            </ul>
            </nav>
            </aside>
			<!--neighbors plugin take -->
			<ul style="float:right;">
			</ul>
			
			
            <div class="comments">
              <h3>Comments</h3>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                var disqus_identifier = "pages/2014/10/dalvik-java-hookgong-cheng";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://9haoblog.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
              </script>
            </div>


        </div><!-- /.eleven.columns -->
        
<div class="three columns">

<div class="sidebarbg">
	<h4>Pages</h4>
	<ul>
	</ul>
</div>

<div class="sidebarbg">
<h4>Categories</h4>
	<ul>
			<li><a href="/category/about-me.html">About me</a></li>
			<li><a href="/category/android.html">Android</a></li>
			<li><a href="/category/internet.html">Internet</a></li>
			<li><a href="/category/za-sui-sui.html">杂碎碎</a></li>
	</ul>
</div>

<div class="sidebarbg">
	<h4>Tags</h4>
		<ul>
			<li class="tag-4"><a href="/tag/za-wen.html">杂文</a></li>
			<li class="tag-1"><a href="/tag/ni-xiang-fen-xi.html">逆向分析</a></li>
			<li class="tag-1"><a href="/tag/android.html">Android</a></li>
			<li class="tag-4"><a href="/tag/guan-yu-wo.html">关于我</a></li>
			<li class="tag-2"><a href="/tag/hook.html">Hook</a></li>
			<li class="tag-4"><a href="/tag/java.html">java</a></li>
		</ul>
</div>



<nav class="widget sidebarbg">
  <h4>Links</h4>
  <ul>
	<li><a target="_blank" href="http://getpelican.com/">Pelican</a></li>
	<li><a target="_blank" href="http://python.org/">Python.org</a></li>
	<li><a target="_blank" href="http://pallergabor.uw.hu/androidblog/dalvik_opcodes.html">Dalvik opcodes</a></li>
	<li><a target="_blank" href="http://0nly3nd.sinaapp.com">0nly3nd</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">
					本博客使用Pelican+GitHub Pages搭建，详细请参考<a href="http://www.xycoding.com/articles/2013/11/21/blog-create/" class="active" target="_blank">教程</a>。
				   </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = '9haoblog';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

      <script src="/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/theme/js/libs/gumby.min.js"></script>
  <script src="/theme/js/plugins.js"></script>
	<script>
	(function() {
		var $backToTopTxt = "返回顶部", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
			.text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
				$("html, body").animate({ scrollTop: 0 }, 120);
		}), $backToTopFun = function() {
			var st = $(document).scrollTop(), winh = $(window).height();
			(st > 0)? $backToTopEle.show(): $backToTopEle.hide();
			//IE6下的定位
			if (!window.XMLHttpRequest) {
				$backToTopEle.css("top", st + winh - 166);
			}
		};
		$(window).bind("scroll", $backToTopFun);
		$(function() { $backToTopFun(); });
	})();
	</script>
</body>
</html>